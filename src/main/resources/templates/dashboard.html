<!--
  dashboard.html — The "Meeting Ready" summary dashboard.

  Renders all sections of the DashboardDTO:
    • AC5  — Production Line Ranking table
    • AC6  — Shipping Risk Alert (red cards)
    • AC7  — Defect Trending with up/down arrows
    • AC8  — Time-grouping toggle (Daily / Weekly / Monthly)
    • AC10 — Orphaned Data table
    • AC11 — Data Conflict table

  Thymeleaf expressions used:
    ${dashboard}             — the DashboardDTO object
    ${dashboard.lineRankings} — List<LineDefectCountDTO>
    th:each="item : ${list}" — iterates over a list
    th:text="${expr}"         — sets element text content
    th:classappend="${cond} ? 'class'" — conditionally adds a CSS class
    th:href="@{/url(param=val)}"     — generates a URL with query params
-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/layout :: head('Dashboard — Steelworks Tracker')}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<!-- Shared navbar -->
<nav th:replace="~{fragments/layout :: navbar}"></nav>

<main class="container">

    <!-- ═══════════════════════════════════════════════════════════
         HEADER + TIME GROUPING TOGGLE (AC8)
         ═══════════════════════════════════════════════════════════ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>Production Dashboard</h1>
            <p class="text-muted">
                <!-- Show the current reporting period -->
                Reporting period:
                <span th:text="${dashboard.periodStart}">2026-02-09</span>
                &mdash;
                <span th:text="${dashboard.periodEnd}">2026-02-15</span>
            </p>
        </div>

        <!-- AC8: Time-grouping toggle buttons -->
        <div class="time-toggle btn-group" role="group" aria-label="Time grouping toggle">
            <a th:href="@{/dashboard(timeGrouping='DAILY')}"
               th:classappend="${dashboard.timeGrouping == 'DAILY'} ? 'active' : ''"
               class="btn btn-outline-primary">Daily</a>
            <a th:href="@{/dashboard(timeGrouping='WEEKLY')}"
               th:classappend="${dashboard.timeGrouping == 'WEEKLY'} ? 'active' : ''"
               class="btn btn-outline-primary">Weekly</a>
            <a th:href="@{/dashboard(timeGrouping='MONTHLY')}"
               th:classappend="${dashboard.timeGrouping == 'MONTHLY'} ? 'active' : ''"
               class="btn btn-outline-primary">Monthly</a>
        </div>
    </div>

    <div class="row">

        <!-- ═══════════════════════════════════════════════════════
             AC5 — PRODUCTION LINE RANKING
             ═══════════════════════════════════════════════════════ -->
        <div class="col-lg-6">
            <div class="card dashboard-card">
                <div class="card-header">
                    &#x1F3ED; Production Line Ranking (AC5)
                </div>
                <div class="card-body">
                    <!-- Show a message if no data -->
                    <div th:if="${#lists.isEmpty(dashboard.lineRankings)}"
                         class="text-muted">No defects recorded for this period.</div>

                    <table th:unless="${#lists.isEmpty(dashboard.lineRankings)}"
                           class="table table-striped table-sm">
                        <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Production Line</th>
                            <th>Defect Count</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Iterate over each ranked line -->
                        <tr th:each="line : ${dashboard.lineRankings}">
                            <td th:text="${line.rank}">1</td>
                            <td th:text="${line.lineName}">Line 1</td>
                            <td>
                                <span class="badge bg-danger" th:text="${line.defectCount}">5</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════
             AC7 — DEFECT TRENDING
             ═══════════════════════════════════════════════════════ -->
        <div class="col-lg-6">
            <div class="card dashboard-card">
                <div class="card-header">
                    &#x1F4CA; Defect Trending (AC7)
                </div>
                <div class="card-body">
                    <div th:if="${#lists.isEmpty(dashboard.defectTrends)}"
                         class="text-muted">No defect trends for this period.</div>

                    <table th:unless="${#lists.isEmpty(dashboard.defectTrends)}"
                           class="table table-striped table-sm">
                        <thead>
                        <tr>
                            <th>Defect Type</th>
                            <th>Severity</th>
                            <th>Current</th>
                            <th>Previous</th>
                            <th>Trend</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="trend : ${dashboard.defectTrends}">
                            <td th:text="${trend.defectName}">Surface Crack</td>
                            <td>
                                <!-- Severity badge with colour coding -->
                                <span class="badge"
                                      th:classappend="${trend.severity == 'Critical'} ? 'severity-critical' :
                                                      (${trend.severity == 'Major'} ? 'severity-major' : 'severity-minor')"
                                      th:text="${trend.severity}">Critical</span>
                            </td>
                            <td th:text="${trend.currentCount}">5</td>
                            <td th:text="${trend.previousCount}">3</td>
                            <td>
                                <!-- AC7: Visual trend indicator (up/down/flat/new) -->
                                <span th:classappend="${trend.trendDirection == 'UP'} ? 'trend-up' :
                                                      (${trend.trendDirection == 'DOWN'} ? 'trend-down' :
                                                      (${trend.trendDirection == 'NEW'} ? 'trend-new' : 'trend-flat'))"
                                      th:text="${trend.trendDirection}">UP</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════
         AC6 — SHIPPING RISK ALERT
         ═══════════════════════════════════════════════════════════ -->
    <div class="card dashboard-card risk-card">
        <div class="card-header text-danger">
            &#x26A0; Shipping Risk Alert — Problematic Shipped Batches (AC6)
        </div>
        <div class="card-body">
            <div th:if="${#lists.isEmpty(dashboard.shippingRisks)}"
                 class="text-success">No problematic shipped batches found. &#x2705;</div>

            <table th:unless="${#lists.isEmpty(dashboard.shippingRisks)}"
                   class="table table-striped table-sm">
                <thead>
                <tr>
                    <th>Lot ID</th>
                    <th>Customer</th>
                    <th>Ship Date</th>
                    <th>Defect</th>
                    <th>Severity</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="risk : ${dashboard.shippingRisks}">
                    <td>
                        <!-- Link to the lot detail page (AC9: source transparency) -->
                        <a th:href="@{/lots/{id}(id=${risk.lotIdentifier})}"
                           th:text="${risk.lotIdentifier}">LOT-001</a>
                    </td>
                    <td th:text="${risk.customerName}">Acme Corp</td>
                    <td th:text="${risk.shipDate}">2026-02-10</td>
                    <td th:text="${risk.defectName}">Surface Crack</td>
                    <td>
                        <span class="badge"
                              th:classappend="${risk.severity == 'Critical'} ? 'severity-critical' :
                                              (${risk.severity == 'Major'} ? 'severity-major' : 'severity-minor')"
                              th:text="${risk.severity}">Critical</span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="row">

        <!-- ═══════════════════════════════════════════════════════
             AC10 — ORPHANED DATA
             ═══════════════════════════════════════════════════════ -->
        <div class="col-lg-6">
            <div class="card dashboard-card warning-card">
                <div class="card-header text-warning">
                    &#x1F50D; Orphaned Data (AC10)
                </div>
                <div class="card-body">
                    <div th:if="${#lists.isEmpty(dashboard.orphanedLots)}"
                         class="text-success">No orphaned records. &#x2705;</div>

                    <table th:unless="${#lists.isEmpty(dashboard.orphanedLots)}"
                           class="table table-striped table-sm">
                        <thead>
                        <tr>
                            <th>Lot ID</th>
                            <th>Part Number</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="orphan : ${dashboard.orphanedLots}">
                            <td th:text="${orphan.lotIdentifier}">LOT-999</td>
                            <td th:text="${orphan.partNumber}">SKU-ABC</td>
                            <td>
                                <span class="badge bg-warning text-dark"
                                      th:text="${orphan.status}">Orphaned Data</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════
             AC11 — DATA CONFLICTS
             ═══════════════════════════════════════════════════════ -->
        <div class="col-lg-6">
            <div class="card dashboard-card warning-card">
                <div class="card-header text-warning">
                    &#x26A0; Data Conflicts (AC11)
                </div>
                <div class="card-body">
                    <div th:if="${#lists.isEmpty(dashboard.dataConflicts)}"
                         class="text-success">No data conflicts. &#x2705;</div>

                    <table th:unless="${#lists.isEmpty(dashboard.dataConflicts)}"
                           class="table table-striped table-sm">
                        <thead>
                        <tr>
                            <th>Lot ID</th>
                            <th>Lines Found</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="conflict : ${dashboard.dataConflicts}">
                            <td>
                                <a th:href="@{/lots/{id}(id=${conflict.lotIdentifier})}"
                                   th:text="${conflict.lotIdentifier}">LOT-002</a>
                            </td>
                            <td th:text="${conflict.distinctLineCount}">2</td>
                            <td>
                                <span class="badge bg-danger">Data Conflict</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</main>

<!-- Shared footer -->
<footer th:replace="~{fragments/layout :: footer}"></footer>

<!-- Bootstrap JS bundle (includes Popper for dropdowns) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
